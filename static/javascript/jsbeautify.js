function js_beautify(a,b){function K(a){a=typeof a==="undefined"?false:a;while(d.length&&(d[d.length-1]===" "||d[d.length-1]===l||d[d.length-1]===y||a&&(d[d.length-1]==="\n"||d[d.length-1]==="\r"))){d.pop()}}function L(a){return a.replace(/^\s\s*|\s\s*$/,"")}function M(a){a=a.replace(/\x0d/g,"");var b=[],c=a.indexOf("\n");while(c!==-1){b.push(a.substring(0,c));a=a.substring(c+1);c=a.indexOf("\n")}if(a.length){b.push(a)}return b}function N(){var a=F;F=false;O();F=a}function O(a){j.eat_next_space=false;if(F&&U(j.mode)){return}a=typeof a==="undefined"?true:a;j.if_line=false;K();if(!d.length){return}if(d[d.length-1]!=="\n"||!a){w=true;d.push("\n")}if(y){d.push(y)}for(var b=0;b<j.indentation_level;b+=1){d.push(l)}if(j.var_line&&j.var_line_reindented){d.push(l)}if(j.case_body){d.push(l)}}function P(){if(f==="TK_COMMENT"){return O()}if(j.eat_next_space){j.eat_next_space=false;return}var a=" ";if(d.length){a=d[d.length-1]}if(a!==" "&&a!=="\n"&&a!==l){d.push(" ")}}function Q(){w=false;j.eat_next_space=false;d.push(e)}function R(){j.indentation_level+=1}function S(){if(d.length&&d[d.length-1]===l){d.pop()}}function T(a){if(j){k.push(j)}j={previous_mode:j?j.mode:"BLOCK",mode:a,var_line:false,var_line_tainted:false,var_line_reindented:false,in_html_comment:false,if_line:false,in_case_statement:false,in_case:false,case_body:false,eat_next_space:false,indentation_baseline:-1,indentation_level:j?j.indentation_level+(j.case_body?1:0)+(j.var_line&&j.var_line_reindented?1:0):0,ternary_depth:0}}function U(a){return a==="[EXPRESSION]"||a==="[INDENTED-EXPRESSION]"}function V(a){return Z(a,["[EXPRESSION]","(EXPRESSION)","(FOR-EXPRESSION)","(COND-EXPRESSION)"])}function W(){u=j.mode==="DO_BLOCK";if(k.length>0){var a=j.mode;j=k.pop();j.previous_mode=a}}function X(a,b){for(var c=0;c<a.length;c++){var d=L(a[c]);if(d.charAt(0)!==b){return false}}return true}function Y(a){return Z(a,["case","return","do","if","throw","else"])}function Z(a,b){for(var c=0;c<b.length;c+=1){if(b[c]===a){return true}}return false}function $(a){var b=p;var d=c.charAt(b);while(Z(d,m)&&d!==a){b++;if(b>=J){return 0}d=c.charAt(b)}return d}function _(){var a;var b;x=0;if(p>=J){return["","TK_EOF"]}v=false;var e=c.charAt(p);p+=1;var h=F&&U(j.mode);if(h){var i=0;while(Z(e,m)){if(e==="\n"){K();d.push("\n");w=true;i=0}else{if(e==="  "){i+=4}else if(e==="\r"){}else{i+=1}}if(p>=J){return["","TK_EOF"]}e=c.charAt(p);p+=1}if(j.indentation_baseline===-1){j.indentation_baseline=i}if(w){for(a=0;a<j.indentation_level+1;a+=1){d.push(l)}if(j.indentation_baseline!==-1){for(a=0;a<i-j.indentation_baseline;a++){d.push(" ")}}}}else{while(Z(e,m)){if(e==="\n"){x+=D?x<=D?1:0:1}if(p>=J){return["","TK_EOF"]}e=c.charAt(p);p+=1}if(C){if(x>1){for(a=0;a<x;a+=1){O(a===0);w=true}}}v=x>0}if(Z(e,n)){if(p<J){while(Z(c.charAt(p),n)){e+=c.charAt(p);p+=1;if(p===J){break}}}if(p!==J&&e.match(/^[0-9]+[Ee]$/)&&(c.charAt(p)==="-"||c.charAt(p)==="+")){var k=c.charAt(p);p+=1;var q=_();e+=k+q[0];return[e,"TK_WORD"]}if(e==="in"){return[e,"TK_OPERATOR"]}if(v&&f!=="TK_OPERATOR"&&f!=="TK_EQUALS"&&!j.if_line&&(C||g!=="var")){O()}return[e,"TK_WORD"]}if(e==="("||e==="["){return[e,"TK_START_EXPR"]}if(e===")"||e==="]"){return[e,"TK_END_EXPR"]}if(e==="{"){return[e,"TK_START_BLOCK"]}if(e==="}"){return[e,"TK_END_BLOCK"]}if(e===";"){return[e,"TK_SEMICOLON"]}if(e==="/"){var s="";var t=true;if(c.charAt(p)==="*"){p+=1;if(p<J){while(p<J&&!(c.charAt(p)==="*"&&c.charAt(p+1)&&c.charAt(p+1)==="/")){e=c.charAt(p);s+=e;if(e==="\n"||e==="\r"){t=false}p+=1;if(p>=J){break}}}p+=2;if(t&&x===0){return["/*"+s+"*/","TK_INLINE_COMMENT"]}else{return["/*"+s+"*/","TK_BLOCK_COMMENT"]}}if(c.charAt(p)==="/"){s=e;while(c.charAt(p)!=="\r"&&c.charAt(p)!=="\n"){s+=c.charAt(p);p+=1;if(p>=J){break}}if(v){O()}return[s,"TK_COMMENT"]}}if(e==="'"||e==='"'||e==="/"&&(f==="TK_WORD"&&Y(g)||g===")"&&Z(j.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"])||f==="TK_COMMA"||f==="TK_COMMENT"||f==="TK_START_EXPR"||f==="TK_START_BLOCK"||f==="TK_END_BLOCK"||f==="TK_OPERATOR"||f==="TK_EQUALS"||f==="TK_EOF"||f==="TK_SEMICOLON")){var u=e;var y=false;var z=0;var A=0;b=e;if(p<J){if(u==="/"){var B=false;while(y||B||c.charAt(p)!==u){b+=c.charAt(p);if(!y){y=c.charAt(p)==="\\";if(c.charAt(p)==="["){B=true}else if(c.charAt(p)==="]"){B=false}}else{y=false}p+=1;if(p>=J){return[b,"TK_STRING"]}}}else{while(y||c.charAt(p)!==u){b+=c.charAt(p);if(z&&z>=A){z=parseInt(b.substr(-A),16);if(z&&z>=32&&z<=126){z=String.fromCharCode(z);b=b.substr(0,b.length-A-2)+(z===u||z==="\\"?"\\":"")+z}z=0}if(z){z++}else if(!y){y=c.charAt(p)==="\\"}else{y=false;if(I){if(c.charAt(p)==="x"){z++;A=2}else if(c.charAt(p)==="u"){z++;A=4}}}p+=1;if(p>=J){return[b,"TK_STRING"]}}}}p+=1;b+=u;if(u==="/"){while(p<J&&Z(c.charAt(p),n)){b+=c.charAt(p);p+=1}}return[b,"TK_STRING"]}if(e==="#"){if(d.length===0&&c.charAt(p)==="!"){b=e;while(p<J&&e!=="\n"){e=c.charAt(p);b+=e;p+=1}d.push(L(b)+"\n");O();return _()}var E="#";if(p<J&&Z(c.charAt(p),r)){do{e=c.charAt(p);E+=e;p+=1}while(p<J&&e!=="#"&&e!=="=");if(e==="#"){}else if(c.charAt(p)==="["&&c.charAt(p+1)==="]"){E+="[]";p+=2}else if(c.charAt(p)==="{"&&c.charAt(p+1)==="}"){E+="{}";p+=2}return[E,"TK_WORD"]}}if(e==="<"&&c.substring(p-1,p+3)==="<!--"){p+=3;e="<!--";while(c.charAt(p)!=="\n"&&p<J){e+=c.charAt(p);p++}j.in_html_comment=true;return[e,"TK_COMMENT"]}if(e==="-"&&j.in_html_comment&&c.substring(p-1,p+2)==="-->"){j.in_html_comment=false;p+=2;if(v){O()}return["-->","TK_COMMENT"]}if(Z(e,o)){while(p<J&&Z(e+c.charAt(p),o)){e+=c.charAt(p);p+=1;if(p>=J){break}}if(e===","){return[e,"TK_COMMA"]}else if(e==="="){return[e,"TK_EQUALS"]}else{return[e,"TK_OPERATOR"]}}return[e,"TK_UNKNOWN"]}var c,d,e,f,g,h,i,j,k,l;var m,n,o,p,q,r;var s,t,u;var v,w,x;var y="";b=b?b:{};var z;if(b.space_after_anon_function!==undefined&&b.jslint_happy===undefined){b.jslint_happy=b.space_after_anon_function}if(b.braces_on_own_line!==undefined){z=b.braces_on_own_line?"expand":"collapse"}z=b.brace_style?b.brace_style:z?z:"collapse";var A=b.indent_size?b.indent_size:4;var B=b.indent_char?b.indent_char:" ";var C=typeof b.preserve_newlines==="undefined"?true:b.preserve_newlines;var D=typeof b.max_preserve_newlines==="undefined"?false:b.max_preserve_newlines;var E=b.jslint_happy==="undefined"?false:b.jslint_happy;var F=typeof b.keep_array_indentation==="undefined"?false:b.keep_array_indentation;var G=typeof b.space_before_conditional==="undefined"?true:b.space_before_conditional;var H=typeof b.indent_case==="undefined"?false:b.indent_case;var I=typeof b.unescape_strings==="undefined"?false:b.unescape_strings;w=false;var J=a.length;l="";while(A>0){l+=B;A-=1}while(a&&(a.charAt(0)===" "||a.charAt(0)===" ")){y+=a.charAt(0);a=a.substring(1)}c=a;i="";f="TK_START_EXPR";g="";h="";d=[];u=false;m="\n\r  ".split("");n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split("");r="0123456789".split("");o="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::";o+=" <%= <% %> <?= <? ?>";o=o.split(" ");q="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(",");k=[];T("BLOCK");p=0;while(true){var ab=_();e=ab[0];t=ab[1];if(t==="TK_EOF"){break}switch(t){case"TK_START_EXPR":if(e==="["){if(f==="TK_WORD"||g===")"){if(Z(g,q)){P()}T("(EXPRESSION)");Q();break}if(j.mode==="[EXPRESSION]"||j.mode==="[INDENTED-EXPRESSION]"){if(h==="]"&&g===","){if(j.mode==="[EXPRESSION]"){j.mode="[INDENTED-EXPRESSION]";if(!F){R()}}T("[EXPRESSION]");if(!F){O()}}else if(g==="["){if(j.mode==="[EXPRESSION]"){j.mode="[INDENTED-EXPRESSION]";if(!F){R()}}T("[EXPRESSION]");if(!F){O()}}else{T("[EXPRESSION]")}}else{T("[EXPRESSION]")}}else{if(i==="for"){T("(FOR-EXPRESSION)")}else if(Z(i,["if","while"])){T("(COND-EXPRESSION)")}else{T("(EXPRESSION)")}}if(g===";"||f==="TK_START_BLOCK"){O()}else if(f==="TK_END_EXPR"||f==="TK_START_EXPR"||f==="TK_END_BLOCK"||g==="."){if(v){O()}}else if(f!=="TK_WORD"&&f!=="TK_OPERATOR"){P()}else if(i==="function"||i==="typeof"){if(E){P()}}else if(Z(g,q)||g==="catch"){if(G){P()}}Q();break;case"TK_END_EXPR":if(e==="]"){if(F){if(g==="}"){S();Q();W();break}}else{if(j.mode==="[INDENTED-EXPRESSION]"){if(g==="]"){W();O();Q();break}}}}W();Q();break;case"TK_START_BLOCK":if(i==="do"){T("DO_BLOCK")}else{T("BLOCK")}if(z==="expand"||z==="expand-strict"){var bb=false;if(z==="expand-strict"){bb=$()==="}";if(!bb){O(true)}}else{if(f!=="TK_OPERATOR"){if(g==="="||Y(g)&&g!=="else"){P()}else{O(true)}}}Q();if(!bb){R()}}else{if(f!=="TK_OPERATOR"&&f!=="TK_START_EXPR"){if(f==="TK_START_BLOCK"){O()}else{P()}}else{if(U(j.previous_mode)&&g===","){if(h==="}"){P()}else{O()}}}R();Q()}break;case"TK_END_BLOCK":W();if(z==="expand"||z==="expand-strict"){if(g!=="{"){O()}Q()}else{if(f==="TK_START_BLOCK"){if(w){S()}else{K()}}else{if(U(j.mode)&&F){F=false;O();F=true}else{O()}}Q()}break;case"TK_WORD":if(u){P();Q();P();u=false;break}s="NONE";if(e==="function"){if(j.var_line&&f!=="TK_EQUALS"){j.var_line_reindented=true}if((w||g===";")&&g!=="{"&&f!=="TK_BLOCK_COMMENT"&&f!=="TK_COMMENT"){x=w?x:0;if(!C){x=1}for(var cb=0;cb<2-x;cb++){O(false)}}if(f==="TK_WORD"){if(g==="get"||g==="set"||g==="new"||g==="return"){P()}else{O()}}else if(f==="TK_OPERATOR"||g==="="){P()}else if(V(j.mode)){}else{O()}Q();i=e;break}if(e==="case"||e==="default"&&j.in_case_statement){if(g===":"||j.case_body){S()}else{if(!H){j.indentation_level--}O();if(!H){j.indentation_level++}}Q();j.in_case=true;j.in_case_statement=true;j.case_body=false;break}if(f==="TK_END_BLOCK"){if(!Z(e.toLowerCase(),["else","catch","finally"])){s="NEWLINE"}else{if(z==="expand"||z==="end-expand"||z==="expand-strict"){s="NEWLINE"}else{s="SPACE";P()}}}else if(f==="TK_SEMICOLON"&&(j.mode==="BLOCK"||j.mode==="DO_BLOCK")){s="NEWLINE"}else if(f==="TK_SEMICOLON"&&V(j.mode)){s="SPACE"}else if(f==="TK_STRING"){s="NEWLINE"}else if(f==="TK_WORD"){if(g==="else"){K(true)}s="SPACE"}else if(f==="TK_START_BLOCK"){s="NEWLINE"}else if(f==="TK_END_EXPR"){P();s="NEWLINE"}if(Z(e,q)&&g!==")"){if(g==="else"){s="SPACE"}else{s="NEWLINE"}}if(j.if_line&&f==="TK_END_EXPR"){j.if_line=false}if(Z(e.toLowerCase(),["else","catch","finally"])){if(f!=="TK_END_BLOCK"||z==="expand"||z==="end-expand"||z==="expand-strict"){O()}else{K(true);P()}}else if(s==="NEWLINE"){if(Y(g)){P()}else if(f!=="TK_END_EXPR"){if((f!=="TK_START_EXPR"||e!=="var")&&g!==":"){if(e==="if"&&i==="else"&&g!=="{"){P()}else{j.var_line=false;j.var_line_reindented=false;O()}}}else if(Z(e,q)&&g!==")"){j.var_line=false;j.var_line_reindented=false;O()}}else if(U(j.mode)&&g===","&&h==="}"){O()}else if(s==="SPACE"){P()}Q();i=e;if(e==="var"){j.var_line=true;j.var_line_reindented=false;j.var_line_tainted=false}if(e==="if"){j.if_line=true}if(e==="else"){j.if_line=false}break;case"TK_SEMICOLON":Q();j.var_line=false;j.var_line_reindented=false;if(j.mode==="OBJECT"){j.mode="BLOCK"}break;case"TK_STRING":if(f==="TK_END_EXPR"&&Z(j.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"])){P()}else if(f==="TK_COMMENT"||f==="TK_STRING"||f==="TK_START_BLOCK"||f==="TK_END_BLOCK"||f==="TK_SEMICOLON"){O()}else if(f==="TK_WORD"){P()}Q();break;case"TK_EQUALS":if(j.var_line){j.var_line_tainted=true}P();Q();P();break;case"TK_COMMA":if(j.var_line){if(V(j.mode)||f==="TK_END_BLOCK"){j.var_line_tainted=false}if(j.var_line_tainted){Q();j.var_line_reindented=true;j.var_line_tainted=false;O();break}else{j.var_line_tainted=false}Q();P();break}if(f==="TK_COMMENT"){O()}if(f==="TK_END_BLOCK"&&j.mode!=="(EXPRESSION)"){Q();if(j.mode==="OBJECT"&&g==="}"){O()}else{P()}}else{if(j.mode==="OBJECT"){Q();O()}else{Q();P()}}break;case"TK_OPERATOR":var db=true;var eb=true;if(Y(g)){P();Q();break}if(e==="*"&&f==="TK_UNKNOWN"&&!h.match(/^\d+$/)){Q();break}if(e===":"&&j.in_case){if(H){j.case_body=true}Q();O();j.in_case=false;break}if(e==="::"){Q();break}if(Z(e,["--","++","!"])||Z(e,["-","+"])&&(Z(f,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||Z(g,q))){db=false;eb=false;if(g===";"&&V(j.mode)){db=true}if(f==="TK_WORD"&&Z(g,q)){db=true}if(j.mode==="BLOCK"&&(g==="{"||g===";")){O()}}else if(e==="."){db=false}else if(e===":"){if(j.ternary_depth===0){if(j.mode==="BLOCK"){j.mode="OBJECT"}db=false}else{j.ternary_depth-=1}}else if(e==="?"){j.ternary_depth+=1}if(db){P()}Q();if(eb){P()}break;case"TK_BLOCK_COMMENT":var fb=M(e);var gb;if(X(fb.slice(1),"*")){O();d.push(fb[0]);for(gb=1;gb<fb.length;gb++){O();d.push(" ");d.push(L(fb[gb]))}}else{if(fb.length>1){O()}else{if(f==="TK_END_BLOCK"){O()}else{P()}}for(gb=0;gb<fb.length;gb++){d.push(fb[gb]);d.push("\n")}}if($("\n")!=="\n"){O()}break;case"TK_INLINE_COMMENT":P();Q();if(V(j.mode)){P()}else{N()}break;case"TK_COMMENT":if(g===","&&!v){K(true)}if(f!=="TK_COMMENT"){if(v){O()}else{P()}}Q();O();break;case"TK_UNKNOWN":if(Y(g)){P()}Q();break}h=g;f=t;g=e}var hb=y+d.join("").replace(/[\r\n ]+$/,"");return hb}if(typeof exports!=="undefined"){exports.js_beautify=js_beautify}
